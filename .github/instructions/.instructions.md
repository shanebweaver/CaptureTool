# GitHub Copilot Instructions for CaptureTool

## Project Overview

CaptureTool is a lightweight and efficient Windows screen capture utility built with:
- **C++20** for native Windows interop (CaptureInterop project)
- **C# 14 / .NET 10** for application logic and UI
- **Windows App SDK 1.8** and **WinUI 3** for modern Windows UI
- **vcpkg** for C++ dependency management (currently using WIL - Windows Implementation Libraries)

The application follows a clean architecture pattern with separated concerns:
- **Core**: Platform-agnostic interfaces and implementations
- **Domains**: Business logic for Capture and Edit features
- **Services**: Application services including feature management
- **ViewModels**: MVVM pattern implementation
- **UI.Windows**: WinUI 3 application layer

## Build and Test Environment

### Prerequisites
- Windows-based development environment
- .NET 10 SDK
- MSBuild (via Visual Studio or Build Tools)
- vcpkg (included as submodule)

### Building the Application

1. **Restore vcpkg dependencies:**
   ```powershell
   vcpkg\bootstrap-vcpkg.bat
   vcpkg\vcpkg.exe install
   ```

2. **Restore .NET dependencies:**
   ```powershell
   dotnet restore
   ```

3. **Build the solution:**
   ```powershell
   # For development (x64)
   msbuild CaptureTool.slnx /p:Configuration=Release /p:Platform=x64
   
   # For ARM64
   msbuild CaptureTool.slnx /p:Configuration=Release /p:Platform=arm64
   ```

### Running Tests

Run the test projects individually:
```powershell
dotnet test src\CaptureInterop.Tests\CaptureInterop.Tests.vcxproj -p:Platform=x64
dotnet test src\CaptureTool.Services.Tests\CaptureTool.Services.Tests.csproj -p:Platform=x64
dotnet test src\CaptureTool.ViewModels.Tests\CaptureTool.ViewModels.Tests.csproj -p:Platform=x64
dotnet test src\CaptureTool.Domains.Edit.Tests\CaptureTool.Domains.Edit.Tests.csproj -p:Platform=x64
```

## Code Standards and Style

### C# Code
- **Language Version**: C# 14
- **Target Framework**: .NET 10
- **Nullable Reference Types**: Enabled
- **Implicit Usings**: Enabled
- **AOT Compatible**: Yes
- **Trimmable**: Yes
- **Warnings as Errors**: Enabled
- **Code Style in Build**: Enforced
- **Primary Constructors**: Not preferred (see .editorconfig)

### Architecture Patterns
- Follow **MVVM** pattern for UI-related code
- Use **interfaces** for abstraction (projects ending in `.Interfaces`)
- Platform-specific implementations go in projects ending in `.Windows`
- Keep business logic in `Domains` projects
- Application services in `Services` projects
- Tests in projects ending in `.Tests`

### Project Organization
- `Core.*`: Core framework and infrastructure
- `Domains.*`: Domain-specific business logic (Capture, Edit)
- `Services.*`: Application-level services
- `ViewModels`: MVVM ViewModels
- `UI.Windows`: WinUI 3 application
- `CaptureInterop`: Native C++ interop layer
- `*.Tests`: Test projects (both C# and C++ test projects)

## Guidelines for Making Changes

### When Adding Features
1. Start with interface definitions in `.Interfaces` projects
2. Implement in corresponding `.Implementations` or `.Implementations.Windows` projects
3. Add tests in corresponding `.Tests` projects
4. Update ViewModels if UI is affected
5. Update UI.Windows if new UI elements are needed

### When Fixing Bugs
1. First, add a failing test that reproduces the bug (if applicable)
2. Fix the bug in the appropriate layer (Core, Domain, Service, or ViewModel)
3. Verify the test passes
4. Run all related tests to ensure no regressions

### When Refactoring
1. Ensure all existing tests pass before starting
2. Make incremental changes
3. Run tests frequently during refactoring
4. Update documentation if public APIs change

## Platform-Specific Considerations

- **Windows-only**: This is a Windows-specific application
- **Platform targets**: x64 and ARM64
- **Windows App SDK**: Required for UI layer
- **Native interop**: Use CaptureInterop project for Windows API calls requiring C++
- **vcpkg**: Managed dependencies should be added to `vcpkg.json`

## Testing Guidelines

- All test projects use the same platform configuration as the main projects (x64 or ARM64)
- Both C# and C++ test projects are supported (C++ tests using vcxproj, C# tests using csproj)
- Unit tests should be fast and isolated
- Mock external dependencies using interfaces
- Test projects follow the naming convention: `[ProjectName].Tests`

## Documentation

- Update README.md for user-facing changes
- Update SECURITY.md for security-related changes
- Use XML documentation comments for public APIs
- Keep code comments minimal and focused on "why" not "what"

## Dependencies

### Adding NuGet Packages
- Central Package Management is used (Directory.Packages.props)
- Add package versions to Directory.Packages.props first
- Reference packages in individual projects without version numbers

### Adding vcpkg Dependencies
- Add to vcpkg.json in the root
- Run `vcpkg install` to restore
- Only used for C++ projects (CaptureInterop)

## CI/CD

- **Pull Requests**: Test workflow runs automatically
- **Main Branch**: Build workflow creates store packages for both x64 and ARM64
- All tests must pass before merging
- Treat warnings as errors - they must be fixed

## Common Tasks

### Adding a New Feature Flag
1. Define in Services.Implementations.FeatureManagement
2. Use via Services.Interfaces

### Adding a New Capture Mode
1. Define interface in Domains.Capture.Interfaces
2. Implement in Domains.Capture.Implementations.Windows
3. Add tests in Domains.Capture.Tests (if exists)
4. Wire up in UI and ViewModels

### Adding a New Edit Tool
1. Define interface in Domains.Edit.Interfaces
2. Implement in Domains.Edit.Implementations.Windows
3. Add tests in Domains.Edit.Tests
4. Wire up in UI and ViewModels

## Best Practices for Copilot

- Always build the solution after making changes to verify compilation
- Run relevant tests after code changes
- Respect the existing architecture and project organization
- Use existing patterns and conventions in the codebase
- When in doubt, look at similar existing code for reference
- Keep changes minimal and focused on the specific issue
- Don't remove working code unless explicitly required
- Follow the platform-specific guidelines (Windows-only considerations)
