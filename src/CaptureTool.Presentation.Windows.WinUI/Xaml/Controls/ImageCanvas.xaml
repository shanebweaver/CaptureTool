<?xml version="1.0" encoding="utf-8" ?>
<local:UserControlBase
    x:Class="CaptureTool.Presentation.Windows.WinUI.Xaml.Controls.ImageCanvas"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:canvasui="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:CaptureTool.Presentation.Windows.WinUI.Xaml.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DataContext="{d:DesignInstance Type=local:ImageCanvas}"
    Background="{ThemeResource LayerOnMicaBaseAltFillColorDefault}"
    IsTabStop="True"
    mc:Ignorable="d">
    <Grid
        x:Name="RootContainer"
        PointerCanceled="RootContainer_PointerCanceled"
        PointerCaptureLost="RootContainer_PointerCaptureLost"
        PointerMoved="RootContainer_PointerMoved"
        PointerPressed="RootContainer_PointerPressed"
        PointerReleased="RootContainer_PointerReleased"
        SizeChanged="RootContainer_SizeChanged">

        <Rectangle
            x:Name="DimmedBackgroundRectangle"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Fill="Black"
            Opacity=".5"
            Visibility="Collapsed" />

        <ScrollView
            x:Name="CanvasScrollView"
            HorizontalScrollBarVisibility="Auto"
            ViewChanged="CanvasScrollView_ViewChanged"
            ZoomMode="Enabled">
            <Grid
                x:Name="CanvasContainer"
                Margin="24"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">

                <canvasui:CanvasControl
                    x:Name="RenderCanvas"
                    CreateResources="CanvasControl_CreateResources"
                    Draw="CanvasControl_Draw" />

                <local:CropOverlay
                    x:Name="CropOverlay"
                    AnchorBottom="{StaticResource CropAnchor_Bottom}"
                    AnchorBottomLeft="{StaticResource CropAnchor_BottomLeft}"
                    AnchorBottomRight="{StaticResource CropAnchor_BottomRight}"
                    AnchorLeft="{StaticResource CropAnchor_Left}"
                    AnchorRight="{StaticResource CropAnchor_Right}"
                    AnchorTop="{StaticResource CropAnchor_Top}"
                    AnchorTopLeft="{StaticResource CropAnchor_TopLeft}"
                    AnchorTopRight="{StaticResource CropAnchor_TopRight}"
                    InteractionComplete="CropOverlay_InteractionComplete"
                    SelectionArea="{x:Bind CropRect, Mode=OneWay}"
                    SelectionAreaChanged="CropOverlay_SelectionAreaChanged"
                    Visibility="{x:Bind IsCropModeEnabled, Mode=OneWay}" />

                <!--  Preview Shape Overlay  -->
                <Canvas
                    x:Name="PreviewShapeCanvas"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    IsHitTestVisible="False"
                    Visibility="Collapsed" />

                <!--  Line/Arrow Endpoint Handles  -->
                <Canvas x:Name="LineEndpointHandlesCanvas" Visibility="Collapsed">
                    <!--  Dashed selection line visual  -->
                    <Line
                        x:Name="LineSelectionVisual"
                        Stroke="{ThemeResource AccentFillColorDefaultBrush}"
                        StrokeDashArray="4,4"
                        StrokeThickness="1"
                        IsHitTestVisible="False" />
                    <!--  Invisible thick line for hit testing and moving  -->
                    <Line
                        x:Name="LineMoveHandle"
                        Stroke="Transparent"
                        StrokeThickness="20"
                        PointerPressed="LineMoveHandle_PointerPressed"
                        PointerMoved="LineMoveHandle_PointerMoved"
                        PointerReleased="LineMoveHandle_PointerReleased"
                        PointerEntered="LineMoveHandle_PointerEntered"
                        PointerExited="LineMoveHandle_PointerExited" />
                    <Ellipse
                        x:Name="LineStartHandle"
                        Width="12"
                        Height="12"
                        Fill="{ThemeResource AccentFillColorDefaultBrush}"
                        Stroke="White"
                        StrokeThickness="2"
                        PointerPressed="LineStartHandle_PointerPressed"
                        PointerMoved="LineStartHandle_PointerMoved"
                        PointerReleased="LineStartHandle_PointerReleased"
                        PointerEntered="LineStartHandle_PointerEntered"
                        PointerExited="LineStartHandle_PointerExited" />
                    <Ellipse
                        x:Name="LineEndHandle"
                        Width="12"
                        Height="12"
                        Fill="{ThemeResource AccentFillColorDefaultBrush}"
                        Stroke="White"
                        StrokeThickness="2"
                        PointerPressed="LineEndHandle_PointerPressed"
                        PointerMoved="LineEndHandle_PointerMoved"
                        PointerReleased="LineEndHandle_PointerReleased"
                        PointerEntered="LineEndHandle_PointerEntered"
                        PointerExited="LineEndHandle_PointerExited" />
                </Canvas>

                <!--  Shape Resize Overlay  -->
                <local:ShapeResizeOverlay
                    x:Name="ShapeResizeOverlay"
                    BoundsChanged="ShapeResizeOverlay_BoundsChanged"
                    ResizeComplete="ShapeResizeOverlay_ResizeComplete"
                    Visibility="Collapsed" />
            </Grid>
        </ScrollView>
    </Grid>
</local:UserControlBase>
